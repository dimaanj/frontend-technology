# Скриншотное тестирование (Screenshot tests)

> Краткая выжимка и проверка по материалам о внедрении скриншотных тестов (Playwright + Docker).

---

## Зачем нужны скриншотные тесты

- **Проблема**: UI-компоненты с большим числом вариантов рендеринга (например, 10+) требуют ручной проверки всех вариантов после изменений. При правках в нескольких таких компонентах объём «проверки глазами» растёт.
- **Ограничения других подходов**:
  - **E2E** (Cypress и др.) и **Snapshot-тесты** (сравнение HTML/дерева) не ловят чисто визуальные/CSS-баги — например, ошибочную замену `display: grid` на `display: flex`.
- **Решение**: **Screenshot-тесты** — сравнение эталонного изображения (baseline) с текущим скриншотом UI. Логика та же, что в unit-тестах: есть ожидаемый результат (картинка) и фактический (новая картинка); тест сравнивает их.

**Проверка**: формулировка корректна. Snapshot = сравнение структуры/данных; screenshot = сравнение пикселей. Для ловли сломанного CSS действительно нужны именно визуальные/скриншотные тесты.

---

## Выбор инструмента

- Не изобретать велосипед: есть готовые решения (сравнение картинок, headless-браузер, отчёты/артефакты).
- Выбор: **Playwright** — быстрый, удобный API, бесплатный. Упоминается альтернатива — кастомная утилита на Puppeteer.

**Проверка**: Playwright действительно подходит для скриншотного тестирования (`expect(page).toHaveScreenshot()` и аналог для элементов), поддерживает Docker и CI. Утверждение про 2026 год — про актуальный стек «Playwright + Docker».

---

## Рецепт: Playwright + Docker

1. **Структура**: папка с описанием компонентов/страниц, которые тестируются (удобно группировать тесты по смыслу).
2. **Хелпер**: функция `testFolder` — последовательно запускает скриншотные тесты для каждой страницы/компонента.
3. **Тесты**: пишутся на основе этих папок.
4. **Запуск в Docker**:  
   `npx playwright test --config=playwright.config.ts`

**Проверка**: подход типичен для визуальных регрессий — базовая конфигурация Playwright + контейнер дают стабильную среду (шрифты, разрешение, ОС).

---

## Производительность

- **Важно**: не перезагружать страницу каждый раз, а **менять контент динамически** средствами фреймворка (например, переключать варианты компонента без полной перезагрузки).
- Иначе: дольше выполнение + возможные глюки с подгрузкой шрифтов, стилей и JS.

**Проверка**: верно. Полная перезагрузка на каждый кейс сильно увеличивает время и даёт нестабильность; один раз подняли приложение — дальше меняем состояние/маршрут/пропсы.

---

## Результаты из опыта

- QA успевали проверять только 200–300 вариантов рендеринга до релиза.
- Скриншотные тесты внедрили через ~3 года; в день мержа PR (последний рабочий день автора) тесты нашли **5 критических ошибок рендеринга** в текущем релизе.
- После внедрения: **400+ тестов** в каждом PR, время прогона — **порядка нескольких минут**.
- Через несколько месяцев после ухода автора коллеги подтвердили: тестами пользуются.

---

## Итог

| Аспект | Суть |
|--------|------|
| **Что это** | Сравнение эталонного скриншота с текущим рендером (baseline vs actual). |
| **Не путать** | Snapshot-тесты (дерево/данные) ≠ Screenshot-тесты (картинки). |
| **Стек** | Playwright + Docker, тесты на основе папок и хелпера `testFolder`. |
| **Перформанс** | Один раз поднять приложение, дальше — динамическая смена состояния без перезагрузки страницы. |

Материал по скриншотному тестированию из постов (01/02/26, 02/07/26) суммирован и проверен; утверждения соответствуют общепринятой практике визуального регрессионного тестирования.
